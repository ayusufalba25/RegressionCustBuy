---
title: "Purchasing Decisions for Customers at Dapur Putih Cafe Metro"
output: html_notebook
---

This project inspired from a thesis called "Pengaruh Tingkat Harga dan Kualitas Produk Terhadap Keputusan Pembelian bagi Konsumen di Dapur Putih Cafe Metro" by Nella Fanitawati in 2020. The data used is also from the thesis itself. The data was generated by Nella Fanitawati from her survey using a questionnaire with a random sampling technique for customers at Dapur Putih Cafe. There are **53 respondents** in the survey.

Dapur Putih Cafe is one of the places to eat in the Metro City that offers food and drinks as well as a comfortable place to hang out. It also offered affordable prices for its products.

The main problem statement was: **How to analyze the influence of the price level and product quality on customer decisions to buy Daput Putih Cafe's products?**

To answer that, we can fit a linear regression model and check if the beta coefficient for its independent variables is significant or not.

```{r}
# Import libraries
library(tidyverse)
library(readxl)
library(skimr)
library(lmtest)
library(psych)
```

```{r}
# Import data
df <- read_xlsx("Dapur Putih Cafe.xlsx")
df
```

There are three variables in the dataset which are consider_buying, price, and product_quality. The dependent variable in this dataset is consider_buying and the remaining variables are the independent variables. Below is the description of each of those variables:

- consider_buying: a condition in which customers decide whether to buy the Dapur Putih Cafe products or not.
- price: the price of products in Dapur Putih Cafe that is based on the affordability of the given prices and the value.
- product_quality: The quality of products in Dapur Putih Cafe.

The values of each variable lie within 5-25 as integers (no decimals). But, we could treat it as a continuous value in regression.

```{r}
# Skim the data
skim(df)
```

After we skim the data, we can see some metrics and a histogram for each variable. As you can see product_quality has the highest mean and median compared to the other variables. It means that the quality of products in Dapur Putih Cafe is reasonably high compared to its prices.

Furthermore, we need to check if there is any clear patterns that shown a relationship between each independent variables on its dependent variable. We can create scatterplots and calculate its spearman correlation coefficient (spearman correlation used cause it does not have assumption about the distribution of the data).

```{r}
# Check if there is any clear of relationship pattern
pairs.panels(df, method = "spearman")
```

From the plot above, we can see that our dependent variable has a higher correlation coefficient with price rather than product_quality. Therefore, we could conclude that customers have a greater chance to buy Dapur Putih Cafe's products because it has affordable prices.

Before we get into modeling, we need to check of there is any outlier in the data based on each of its variable. We can use boxplot to visualize and check the outliers.

```{r}
# Check if there is any outliers in the data using boxplot
par(mfrow = c(1, 3))
boxplot(df$consider_buying)
boxplot(df$price)
boxplot(df$product_quality)
```
From each of the boxplot we can see that there is no outliers in the data. Then, we could prepare the data for modeling by split the data into training and test set with 80:20 ratios.

```{r}
# Split the data into train and test set
set.seed(123)
train_set = sample(1:nrow(df), round(0.8 * nrow(df), 0))
df_train <- df[train_set,]
df_test <- df[-train_set,]
```

```{r}
# Fitting linear regression model
model <- lm(consider_buying ~ ., data = df_train)
summary(model)
plot(model)
```

```{r}
# Fitting linear regression model but without product_quality
model <- lm(consider_buying ~ price, data = df_train)
summary(model)
plot(model)
```
```{r}
# Removing outliers which are the 7th, 17th, and 24th rows in the training data

```



```{r}
# Model assumption checking

# Normality test for residual
shapiro.test(model$residuals)

# Heteroscedasticity test
bptest(model)
```



```{r}

```

```{r}
# Prediction performance

# Predict test data
y_test_pred <- predict(model, df_test[-1])

# RMSE
rmse <- function(y_true, y_pred){
  mse <- mean((y_true - y_pred) ^ 2)
  return(sqrt(mse))
}
cat("RMSE =", rmse(df_test$consider_buying, y_test_pred), "\n")

# MAPE
mape <- function(y_true, y_pred){
  return((mean(abs(y_true - y_pred) / y_true) * 100))
}
cat("MAPE =", mape(df_test$consider_buying, y_test_pred))
```

```{r}
# Check the difference
cbind(df_test$consider_buying, round(y_test_pred, 0))
```

```{r}
# Clustering customers
cluster_customer <- kmeans(df, 2)
cluster_customer
```

```{r}

```

```{r}

```

